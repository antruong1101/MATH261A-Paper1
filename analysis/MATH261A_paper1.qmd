---
title: "Temporal Patterns in Police Call Prioritization"
author: "An Truong"
format: pdf
editor: visual
date: "September 24, 2025"
bibliography: "paper_1.bib"
---

## Date: September 24, 2025

## Abstract

The priority of emergency calls to the police can tell a lot about the offense that occurred due to it allowing dispatchers to know who to send and how much personnel is needed. Modeled with time of day can highlight patterns of calls based on their severity and priority. The aim of this paper was to model this relationship with simple liner regression but it is obvious that the discrete and ordinal nature of the data makes it difficult to be modeled well. Despite these issues, a lot can be learned from how this model doesn't fit by observing the plots that measure the model and its errors.

## Introduction

Contacting emergency personnel through dialing 911 has allowed direct contact to police, fire, and EMS services in times of critical need. This allows the emergency personnel to quickly be dispatched to provide life-saving services and/or instructions. Once called, data from the call is documented and stored in records that shows information on the call such as date, time, and where an offense took place for example. To rate on how urgent or dire an offense is, priority is rated on a numerical scale to represent this, where one is critical, imminent danger to life and six is a traffic jam. In this paper, the aim is to address the relationship between the priority of an offense and the time of day that the offense occurred.

The goals is to see how the time of day can affect the priority of an emergency call. Another way to frame this goal into a question is: "How can understanding temporal patterns improve emergency response times for critical calls?". To address this, a simple linear regression model was fitted onto the data from the 2024 Police Calls for Service from the city of San José where the response variable was the priority codes and the explanatory was the time of call made (offense time). When analyzing this model, scatter and frequency plots were used to observe the relationship between the two variables. The fit of the linear model was measured by visualizing the residuals of the model using the residual vs. fitted values plot, the QQ-plot, and the histogram of the residuals.

Despite prior assumptions being violated prior to modeling the data, it was informative to understand why a simple linear regression model would not be a good fit for the data. It does not make sense to fit a linear regression model to two ordered and discrete variables where offense time is also cyclical due to it being measured as the time of day. These issues illustrated why it is better to use other regression models that are better fitting for the data such as an ordinal regression model. In future approaches, modeling the relationship between two continuous variables would be better fitting for a simple linear regression model.

## Data

The study uses the Police Calls for Service dataset(s) that comes from the San José Open Data website[@noauthor_police-calls-for-service_nodate]. In obtaining the variables of interest, the priority code and time of day were extracted as columns, where the offense date was represented in 24-hour time to better represent the time for the simple linear regression model. The priority code is used for "managing calls for service and providing the appropriate response" per the San Jose Police Department Handbook. Each code can be explained as:

1.  Life-threatening emergencies or major felonies in progress requiring immediate city-wide response.

2.  In-progress crimes with injuries/potential injuries where suspect is still in the area, or missing children under 12/at-risk persons.

3.  Recently occurred property crimes where the suspect has likely fled, or cooperative suspects in custody for non-violent crimes.

4.  Non-violent crimes with no immediate danger where the suspect has left and response can be delayed during the shift.

5.  Officer-initiated events observed directly by police ("on-view" activities).

6.  Traffic stops and pedestrian stops initiated by officers.

```{r, message = FALSE, warning = FALSE, echo=FALSE}
# install libraries
library(tidyverse)
library(hms)
library(usethis)
use_git_config(user.name = "antruong1101", user.email = "an.truong8@gmail.com")
```

```{r, message = FALSE, warning = FALSE, echo=FALSE}
# download Police Calls 2024 csv file
setwd('/Users/antruong/Downloads/MATH261A/MATH261A-Paper1')
pc_2024 <- read_csv('police_calls_2024.csv')
```

```{r, message = FALSE, warning = FALSE, echo=FALSE}
pc_2024_df <- pc_2024 %>% 
  select(PRIORITY, OFFENSE_TIME) %>%
  mutate(PRIORITY = as.numeric(PRIORITY),
         OFFENSE_TIME = hour(as_hms(OFFENSE_TIME))) %>%
  filter(PRIORITY <= 6)
summary(pc_2024_df)
```

From calculating the frequencies for each priority code and plotting them with time of day we can see the trends for each code throughout the day. The multifaceted bar plots illustrates the frequency of calls for each priority code, where we can see a trend from priority codes 2 and 3 that have a similar distributions in calls. For those two priority codes, we can also see that they hold up as a majority of the calls throughout the day compared to the most critical priority code 1, which has less calls but tend to pick up in the evening to night time from 8 p.m. to 10 p.m.

```{r priority_freq_table, message = FALSE, warning = FALSE, echo=FALSE}
# create frequency table
freq_table <- pc_2024_df %>%
  group_by(OFFENSE_TIME, PRIORITY) %>%
  summarise(count = n(), .groups = 'drop')

# convert PRIORITY to factor for better plotting
freq_table$PRIORITY <- as.factor(freq_table$PRIORITY)
```

```{r priority_freq_plot_facet, message = FALSE, warning = FALSE, echo=FALSE}
priority_freq <- ggplot(freq_table, aes(x = OFFENSE_TIME, y = count, fill = PRIORITY)) +
  geom_bar(stat = "identity") +
  facet_wrap(~ PRIORITY, ncol = 2, scales = "free_y") +
  scale_x_continuous(breaks = seq(0, 23, by = 4)) +
  labs(title = "Police Call Frequencies by Hour for Each Priority Code",
       x = "Hour of Day",
       y = "Number of Calls") +
  theme_minimal() +
  theme(legend.position = "none")

print(priority_freq)

```

```{r priority_freq_plot_all, message = FALSE, warning = FALSE, echo=FALSE}
priority_freq_hr <- ggplot(freq_table, aes(x = OFFENSE_TIME, y = count, color = PRIORITY, group = PRIORITY)) +
  geom_line(size = 1.2) +
  geom_point(size = 2) +
  scale_x_continuous(breaks = 0:23, labels = 0:23) +
  scale_color_brewer(palette = "RdYlBu", direction = -1) +
  labs(title = "Frequency of Police Call Priorities by Hour of Day in 2024",
       x = "Hour of Day",
       y = "Number of Calls",
       color = "Priority Code") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

print(priority_freq_hr)
```

## Methods

The simple linear regression model with the dependent variable PRIORITY and the independent variable OFFENSE_TIME can be modeled as:

$$
Y_i = \beta_0 + \beta_1X_i + \epsilon_i
$$

where:

-   $Y_i$ is the priority code of the i-th call

-   $\beta_0$ is the intercept, the expected priority code when it is midnight (OFFENSE_TIME = 0)

-   $\beta_1$ is the regression coefficient, how much the expected priority code will change as x increases by one hour

-   $X_i$ is the time of day for the i-th call

-   $\epsilon_i$ is the error of estimate

```{r, echo=FALSE, include=FALSE}
# linear model does not apply, because cyclical pattern
priority_lm <- lm(PRIORITY~OFFENSE_TIME, data=pc_2024_df)
summary(priority_lm)
```

```{r, message = FALSE, warning = FALSE, echo=FALSE}
ggplot(pc_2024_df, aes(x = OFFENSE_TIME, y = PRIORITY)) + 
  geom_jitter(alpha = 0.6, size = 2, color = 'steelblue', width = 0.2, height = 0.2) +
  #geom_point(alpha = 0.6, size = 2, color = "steelblue") +
  geom_smooth(method = 'lm', se = TRUE, color = 'red', linetype = 'solid') + 
  labs(title = 'Scatterplot with Regression Line (Jittered)', x = 'OFFENSE_TIME(24hr time)', y = 'PRIORITY(1-6)') + theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))
  
```

Upon fitting a simple linear regression model in R, we can interpret the coefficients of having an intercept of `r round(coefficients(priority_lm)[1], 3)` when it is midnight (OFFENSE_TIME = 0) and a slope `r round(coefficients(priority_lm)['OFFENSE_TIME'], 3)`, which can be interpreted as the increase in the expected priority code for a one hour increase in the day. Although the model suggest significant coefficients with low p-values, observing a low adjusted-$R^2$ value of `r summary(priority_lm)$adj.r.squared` tells us that the data does not fit the model well. It is more evident when the plot with the regression line is plotted and it can be observed that the regression line is close to 0 and does not explain the data well either.

Since the OFFENSE_TIME is cyclical, it cannot be modeled with a simple linear regression model. The linear nature of the simple regression model could not account for the "wrap-around" from 11 p.m. to 12 a.m.

## Result

```{r, message = FALSE, warning = FALSE, echo=FALSE}
#dim(pc_2024_df)
residuals <- residuals(priority_lm)
fitted_values <- fitted(priority_lm)

set.seed(420)
sample_size <- 5000
sample_idx <- sample(length(residuals), sample_size)

plot(fitted_values[sample_idx], residuals[sample_idx],
     pch = 20,
     cex = 0.5, 
     col = alpha('blue', 0.6),
     xlab = 'Fitted Values',
     ylab = 'Residuals',
     main = 'Residual Plot')
abline(h = 0, col = 'red', lty = 2, lwd = 2)

lines(lowess(fitted_values[sample_idx], residuals[sample_idx]),
      col = 'green', lwd = 2)
```

```{r resid_qq_norm_an_histogram, message = FALSE, warning = FALSE, echo=FALSE}
res <- residuals(priority_lm)
qqnorm(res)
qqline(res, col = 'red')

hist(res, 
     main = "Histogram of Residuals", 
     xlab = "Residuals", 
     col = "lightblue",
     border = "black",
     breaks = 20)
```

From the simple linear regression model mentioned before, it is obvious that validity fails because a cyclical nature of the independent variable OFFENSE_TIME cannot be modeled linearly. Although the representative assumption can be made for the population of San José, the assumption of additivity and linearity fails due to the relationship between the PRIORITY_CODE and OFFENSE_TIME. From the residual plot above, it can be seen that the error terms are not normally distributed and this can be further shown from the QQ-plot and histogram plot of the residuals that are also shown below. It can be observed the the QQ-plot and the histogram plot do not follow any linear patterns.

## Discussion

Since the simple linear regression model does not fit the data well, it is safe to assume that other regression models such as an ordinal regression model such as [@ordinal], that can model ordered and discrete dependent variables like priority codes and can be tuned further from using the better fitting link function. Another approach that can be done is using the sine-cosine transformation as seen in [@van_wyk_encoding_nodate] to preserve the cyclical nature of the offense time and introduces two continuous variables that are more interpretable for a model. But since the goal of this paper was to use a simple linear regression model with one explanatory variable, using the sine-cosine transformation would not work out. Despite not being able to use a simple linear regression model for the data and goal of this paper, it was very informative to see the relationship between emergency call priority code and time of day from the frequency plots.

## References
